select
  A.CODAVALIACAO AS CODAVALIACAO,
  A.NOME AS NOME,
  P.CODPARTICIPANTE AS CODPARTICIPANTE,
  P.CHAPAAVALIADO AS CHAPAVALIADO,
  L.DTINICIAL AS DTINICIAL,
  L.DTFINAL AS DTFINAL,
  A.DATAABERTURA AS DTABERTURA,
  IF(A.DATAABERTURA >= DTINICIAL AND A.DATAVALIDADE <= DTFINAL, 'S', 'N') AS LICENCA
from participantes AS P
inner join avaliacoes AS A
ON A.CODCOLIGADA = P.CODCOLIGADA AND A.CODAVALIACAO = P.CODAVALIACAO
LEFT JOIN licencas AS L
ON L.CHAPA = P.CHAPAAVALIADO
WHERE P.CODAVALIACAO >= 25 
GROUP BY P.CHAPAAVALIADO ,A.CODAVALIACAO, DTINICIAL
HAVING DTINICIAL > 0 
ORDER BY LICENCA DESC; 
